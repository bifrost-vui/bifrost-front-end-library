# Contribute to the Bifr√∂st Front-end Library

> If you plan to contribute, please read this contribution guidelines carefully.

If you have any question or if something is missing, feel free to notify Bifrost Team.

<br />

## Overview

The Bifr√∂st Design-system is the combination of spaces

Public spaces:

-   **Technical documentation** on [Storybook](https://bifrost-front-end-library-vui.vercel.app/) (what you are reading right now)
-   **Front-end library** on [NPM](https://www.npmjs.com/package/@videotron-ui/bifrost-front-end-library)
-   **The source of the library** on [GitHub](https://github.com/bifrost-vui/bifrost-front-end-library)
-   **Discussions** on [GitHub Discussion channel](https://github.com/bifrost-vui/bifrost-front-end-library/discussions)

Private spaces:

-   **Global documentation** on [Zeroheight](https://zeroheight.com/79f1d3365).
-   **Design documentation** on [Figma](https://www.figma.com/file/7bTmk29aCBl7rCFszffYPr/DS---Components-%26-styles?node-id=0%3A1).
-   **Project management** on Jira
-   **Discussions** on Teams Channels.

## Issues?

-   1. **Issues with a component** (basically, component property or CSS issues.)
    -   => Please, flag on Github repos issues Tab => Videotron Bifrost team will fix the issue or contributor could suggest a PR in the design system with CoreTeam member in review (refer to CONTRIBUTING.mdx).
-   2. **Issues with the website** => Product team fix the issue.

## Frameworks

The Front-end library supports 2 frameworks: **Angular** and **Twig**.
As of today, we put effort in Twig. That's why you will not find any Angular components in Storybook. However, the library architecture is ready to publish an **Angular Library**.

## Content

The Front-end library provides 5 kinds of elements:

-   **CSS Styles** : Base styles for all Videotron project.
-   **JS Scripts** : Javascript required for Bifr√∂st components.
-   **Components** : All Angular and Twig components.
-   **Pipes** : Angular Pipes (Work in progress).
-   **Assets** : E.g. Logo, fonts, icons, illustrations, images, ...

<br />

# Run projects locally

## Run Bifr√∂st Library (Storybook)

Ask Bifr√∂st Team for access to the Bifr√∂st repository then start it:

```bash
# Clone the repo
git clone git@github.com/bifrost-vui/bifrost-front-end-library.git

npm install

# Launch Storybook:
npm run start-dev
```

At this point, Storybook should open on **http://localhost:9008** with the Front-end library inside.

### Post installation

The project use Prettier to remove any discusion about styling, so that Pull request are focus on the code instead of the styling.
You should ensure

-   your IDE is working is the `.editorconfig` _what is [editorconfig](https://editorconfig.org/#overview)_
-   You have install a helper coding tool. _suggestion : [Tabnine](https://hub.tabnine.com/)_
-   Configure your IDE to use [Prettier config](https://prettier.io/docs/en/editors.html)
    <br />

**Take a time, to explore components in Storybook.** For each component:

-   **Canvas tab** (on top of the page) displays the component. You could change inputs in the **controls** tab and see how components behave.
-   **Docs tab** displays a technical documentation. Basically, an example of integration and the Component API.

## Run Drupal Showcase

The only purpose of the Drupal Showcase is to check the implementation in a real Drupal environment.
‚ö†Ô∏è This showcase is in progress. It's possible that you will not be able to launch Drupal.

```bash
npm run showcase-drupal:start
```

## Run Angular Showcase

üöß This showcase is in work in progress.

<br />

# Start-dev

<br />

Storybook provides an environment to develop in isolation. Let's open it:

```bash
npm run start-dev
```

> Under the hood, `npm run start-dev` will:

-   Launch an express server to serve twig files.
-   Watch changes on twig files and auto-reload.
-   Prebuild Storybook (**Compodoc** fetch Angular components props in order to display **Controls Panel** in Storybook).
-   Finally, launch Storybook at **http://localhost:9008**.

**Note about Hot Module Reload:** Since **Drupal** components are server side, you need to refresh the browser to see changes during development.

<br />

# What you should know before contributing

<br />

### Frameworks

**Angular and Drupal** share the **same component API** and the **same CSS**.

### Workflow (in short)

**1. Jira ticket**
Everything starts with a Jira ticket :)

-   The goal might come from different source.
-   Videotron Designer: Set the goal of new components, and change in design required.
-   Core Team: Improvement of the project or technical requirements. Also, Bifrostisation of UIKIT components
-   Consumer: They inform us of a bug, an improvement required, and new need from their contact(ex Studio)

**2. Understand the needs**

-   Design: Check if you have the right Figma link.
-   Design: If necessary, talk to the designer/stakeholder to be sure that context, needs and scope are well-defined.
-   Design: If necessary, ask for design specification (responsive, hover states, ...).
-   Scope: Check the impact on both Angular and Drupal.
-   Roadmap: It is an urgent fix or not, project scope, etc.

**3. Develop**

-   Git: For each change, create a new branch with the id of the Jira ticket.
-   Git: Use the commit naming convention (see below).
-   Develop in isolation locally with Storybook.
-   Ensure you use and IDE compatible with the `.editorconfig`. It give the code styling
-   Run a `npm run prettier:format` to ensure every code is accuratly formated
-   Set the changelog if the goal was to update something reflected in the NPM package.
-   Create your Pull Request, when ready to interact with team member.
-   Git: Push in your branch to run automated tests.

**4. Document**

-   Add complete documentation (See [merge checklist](?path=/docs/merge-checklist--page))

**5. Test**

-   On Github, check if automated tests are passed.
-   Review visual tests with Chromatic (üöß work in progress).
-   Check the complete [merge checklist](?path=/docs/merge-checklist--page).

**6. Review**

When ready to review, move your Jira to "In Review(dev)"

-   Assign Reviewer(s) in GitHub to your pull request
    When ready to review by a designer, move your Jira to "In Review(ui)"
-   Share PR Preview URL to UI/UX designer or stakeholders and ask for visual review.
    When everyone has approved your work, move your Jira to "Ready to merge"
-   tag the PR with label `ready to merge`.

**7. Wait for merge**

When required (depending on Minor of Patch version), core maintainers will merge `ready to merge` branches into related branch. Then build and publish a new version of the **NPM package**.
The process of merging depends on if the reality of what the Release is about.

-   If it is a Patch: The version must include only change agreed with the end Customer
-   If no other minor version has been release: Merge the PR on master if he is clean in the history from the last
-   In any other case: Start a branch from the last version TAG, and merge into the new branch.
-   If it is a Minor: The version can include any kind of change.
-   Merge PR into Master.
    The core maintainers notify everyone in the Bifrost Teams channel with a link to the new changelog.

### Git commit message

In the future, Bifrost will rely on the [conventional-commit format specification](https://www.conventionalcommits.org/en/v1.0.0-beta.2/#specification).
By formalizing our commit message format, this allows us to easily generate changelogs and scan through the commit history.
It also automates [semantic versioning](https://semver.org/).
To work well with Jira: Each commit message should start with the Jira id.

### Merge checklist

Each component should pass this [merge checklist](?path=/docs/merge-checklist--page), else log a ticket in JIRA in order to improve the component later.

### Browser compatibility

Run `npx browserslist` to list all browsers supported.

### Component API

Please, define your component API carefully. A future change could generate a **Break change**.
**Property names should be:**

-   **Universal:** Make it agnostic to be used in any context.
-   **Consistent:** It should be consistent with the current API. Try to find a similar properties in other Bifrost components to validate your naming.
-   **Clear:** As simple and clear as possible.

### CSS: Scope

In order to keep backward-compatibility, we scope all Bifrost new CSS classes with `bf-` (E.g. `bf-button`, `bf-color-bg-neutral`, ...).

### CSS: BEM

In most case, we use CSS [BEM architecture](http://getbem.com/introduction/).

### CSS: Decisions Tree

If you need to add/change a style:

1. If Bootstrap provides a class for that style, use it in the html or `@extends` the Bootstrap class in your SCSS file. We tend to respect Bootstrap **utility-first** architecture.
2. If the class should be global, define if it's the Bifrost responsibility or not.

-   It yes, prefix the class with `bf-` and host it in a SCSS file in **/lib/scss/dependencies/bifrost/**.
-   If not, you should **warn Bifrost Team** that it could generate visual regressions.

### JS variable bfTheme

In order to pass Breakpoints to Carousel. We created a global variable `bfTheme`. Feel free to type it in the console to explore it.

### Storybook

Feel free to add any [stories](https://storybook.js.org/docs/angular/writing-stories/introduction) as you wish to showcase different states of your component. For example, we added a story for [Card Plan - Disabled](http://localhost:9008/?path=/story/components-card--drupal-plan-disabled) because it is easier to check than to hit the **Disable switch** in **Controls** panel.
You could add stories in the same `doc.stories.ts`, or create a new file if it's relevant (E.g. `specific-variant.stories.ts`).

### Twig Filters

See the [complete list of required twig filters](?path=/docs/implementation-drupal-filters--page).
Warning! Before choosing a name for a new twig filter, ask DXP if they don't have a filter with the same name.

<br />

# Create a new component

> **Before creating a new component**, check with the Bifrost Team if it's really a creation and not a variant of an existing component.

This command will help you generate the component's structure:

```bash
# Run a Bifr√∂st CLI
npm run bifrost:generate
```

FYI, this command will:

-   Copy `.templates/component-structure` folder and paste it in `/lib/components`.
-   Import component's style to the main style `index.scss`.
-   Expose your new Angular component in `public-api.ts`.

For Angular, don't forget to export your new module and/or component in `/lib/public-api.ts`.

## Add a new Icon

1. Receive the small and large svg file from designer exported from Figma
1. Save those files in `/public/icons/`

-   Ensure to follow the naming convention (aka: `[icon-name]-[sm|lg].svg`)

1. Open those SVG files and replace all hardcoded color for `currentColor`
1. Copy each SVG files into `projects/front-end-library/src/lib/components/icon/twig/svg-twig`
   and rename them : [original-name.svg].twig
1. (If the icon is an Illustration icon) Write into the file `public/icons/list/illustrations.json` the name of the component into the category it belongs
1. (If the icon is an Interface icon) Write into the file `public/icons/list/interface.json` the name of the component into the category it belongs
1. Test in storybook, all color, size and reverse state work properly, and he can be selected in component displaying icons

<br />

# Build and Publish Front-end library

Create a branch and a Pull Request (when the branch will be pushed on Github) named after the version number and replace the dots with hyphens (eg: v1-1-1).

Here's some infos:

-   The replacement from dots to hyphens is for Vercel to format the right URL.
-   The new Pull Request give us a space to work.
-   For a Minor, work on last changes for the CHANGELOG and generate the version URL for it.
-   For a Patch, merge and fix corresponding Jira problem required. It also give us the space to work on the CHANGELOG and version URL.

On the branch version, increment the version in `projects/front-end-library/package.json` depending on the context of the version for the pattern: **MAJOR.MINOR.PATCH**.

## 1) Before proceeding

Now that you know what will be the **new package version number**, make sure that in your `.svg` and
`.svg.twig` that has been added or modified you **have the right version number** in the `data-version` attribute.

If you don't have any, skip this step.

## 2) Create the new branch

> **Change the version number in the example below for your version number** > _Don't forget to use hyphens here instead of dots_

```bash
git checkout -b v1-1-1
```

## 3) Before the commit

> **Don't forget to do these things**

-   [ ] Update version number in `projects/front-end-library/package.json`
-   [ ] CHANGELOG is properly written, explicit and understandable with new features and or bugs fix.
    -   For the Vercel link on the version number, just use the link for a past version and change the version number for yours

## 4) Commit, Push & create a Pull Request on GitHub

> **Be sure to be up to date with the `master` branch**

```bash
git fetch
git pull
```

> **Then commit and push**
>
> -   _Don't forget to change the version number in the example below_
> -   _Here, use **dots** for the version number_

```bash
git add CHANGELOG.mdx
git add projects/front-end-library/package.json
git commit -m "v1.1.1 new npm package release"
git push
```

> **Then, create a Pull Request**

## 5) Create the new tag

> **Change the version number in the example below for your version number**.
>
> _Here, use **dots** for the version number_

```bash
git tag v1.1.1
git push --tags
```

## 6) Make the NPM package

Only maintainer have the power to do this. You need to have access to the `videotron-ui` organization on [NPMJS](https://www.npmjs.com/). If you don't, you need to ask your manager for access.

> **First, you need to log in**

```bash
npm login --scope=@videotron-ui
```

> **Then, you run this command to publish your package**
> This command will build and publish a new version of the front-end library.

```bash
npm run publish
```

Your new package version is now available for everyone.
You could check availability on the [NPM registry](https://www.npmjs.com/package/@videotron-ui/bifrost-front-end-library) page.

## 7) Merge your PR into the `master` branch

Now that the NPM package is created, you can merge your PR into the `master` branch.

## 8) Make the new Jira release

1. If it's not already done, create a new release in [Jira release page](https://groupemedia.atlassian.net/projects/DS?selectedItem=com.atlassian.jira.jira-projects-plugin:release-page). The Jira release number is the same as the version created in earlier steps. Then adjust the description to explain what was done in this new release.

2. In [Jira Kanban view](https://groupemedia.atlassian.net/jira/software/c/projects/DS/boards/1036), for all the tickets that are in the `READY TO PACKAGE` column, if it's not already done, add a `Fix versions / Versions corrig√©es` to the same number as the new Jira release number.

3. Then, move all tickets from `READY TO PACKAGE` column to `PACKAGED - CLOSED` column.

4. In [Jira release page](https://groupemedia.atlassian.net/projects/DS?selectedItem=com.atlassian.jira.jira-projects-plugin:release-page), find the related release number and "release it". You do it by pressing the `RELEASE / PUBLIER` button.

## 8) Make the new GitHub release

1. On GitHub, find your tag in the [tag page](https://github.com/bifrost-vui/bifrost-front-end-library/tags).

2. Click on the `Create release from tag` button

3. Add a description to your release. Use the text below, **but don't forget to change all links path to the right ones**.

```markdown
### Storybook changelog

https://bifrost-front-end-library-git-v1-13-0-bifrost-vui.vercel.app/?path=/docs/changelog--page

### ChangeLog Jira

https://groupemedia.atlassian.net/projects/DS/versions/38177/tab/release-report-all-issues

### NPM package

https://www.npmjs.com/package/@videotron-ui/bifrost-front-end-library/v/1.13.0
```

4. Save
