# Contribute to the Bifrost Front-end Library

> Please, read this guide of contribution carefully before contributing.

If you have any question or if something is missing, feel free to notify Bifrost Team.

## Teams Channel
// TODO indicate Channel name

<br/>

## Frameworks

The Bifrost library supports 2 frameworks: **Angular** and **Twig**.

**//TBD** This means that for each component creation/modification, we need to add an advancement status


## Content

The Bifrost library provides 5 kinds of elements:
- **CSS Styles** : Base styles for all Videotron project.
- **JS Scripts** : Javascript required for Bifrost components.
- **Components** : All components.
- **Pipes** : Angular Pipes (Work in progress).
- **Assets** : E.g. Logo, images, fonts, ...


## Workflow in short

1. For each changes, create a new branch with the name of the JIRA ticket.
2. Test changes in isolation locally with Storybook.
3. Check if automated tests are valid.
4. Share PR Preview URL to UI designer or stackholders and ask for review.
5. After validation, tag the branch as 'ready to merge'.
6. Each Tuesday morning, we merge 'ready to merge' branches in master (only a member of the Bifrost Team is able to merge in master).
7. Then, Bifrost Team build and publish a new version of the **NPM package**.

<br/>


# Run projects locally

## Run Bifrost Library (Storybook)

Ask Bifrost Team for an access to the Bifrost repository then start it:

```bash
# Clone the repo
git clone git@github.com:JonathanLefebvreV/bifrost-front-end-library.git

# Install npm-run-all globally
npm install npm-run-all -g

# Launch Storybook:
npm run start-dev
```

At this point, it should open the Storybook page of the Bifrost library.

<br/>

**Take a time, to explore components.** For each component:
 - **Canvas** tab (on top of the page) displays the component. You could change inputs in the **controls** tab and see how the component behaves.
 - **Docs** tab displays a technical documentation. Basically, an example of integration and the Component API.

## Run Drupal Showcase

The only purpose of the Drupal Showcase is to check the implementation in a real Drupal environment.

This check is optionnal, however you could launch Drupal:

```bash
npm run showcase-drupal:start
```

## Run Angular Showcase

This showcase is in work in progress.

<br/>

# Start-dev

Storybook provides an environment to develop in isolation. Let's open it:

```bash
npm run start-dev
```

> Under the hood, `npm run start-dev` will:
> - Launch an express server to serve twig files.
> - Watch changes on twig files and auto-reload.
> - Prebuild Storybook (**Compodoc** fetch Angular components props in order to display **Controls Panel** in Storybook).
> - Finally, launch Storybook at **http://localhost:9008**.

**Note about Hot Module Reload:** Since **Drupal** components are server side, you need to refresh the browser to see changes during development.

<br/>


# What you should know before developement

<br/>

### Frameworks
**Angular and Drupal** share the **same component API** and the **same CSS**.


### Browser compatibility
Run `npx browserslist` to list all browsers supported.

### Component API
Please, define your component API carefully. A futur change could generate a **Break change**.

**Property names should be:**
- **Universal:** Make it agnostic to be used in any context.
- **Consistent:** It should be consistent with the current API. Try to find a similar properties in other Bifrost components to validate your naming. 
- **Clear:** As simple and clear as possible.


### CSS: Scope
In order to keep backward-compatibility, we scope all Bifrost new CSS classes with `bf-` (E.g. `bf-button`, `bf-color-bg-neutral`, ...).

### CSS: BEM
In most case, we use CSS [BEM architecture](http://getbem.com/introduction/).

### CSS: Decisions Tree
If you need to add/change a style:
1. If Bootstrap provides a class for that style, use it in the html or `@extends` the Bootstrap class in your SCSS file.
2. If the class should be global, define if it's the Bifrost responsability or not. 
    - It yes, prefix the class with `bf-` and host it in a SCSS file in **/lib/scss/dependencies/bifrost/**.
    - If not, you should **warn Bifrost Team** that it could generate visual regressions.

### JS variable bfTheme
In order to pass Breakpoints to Carousel. We created a global variable `bfTheme`. Feel free to type it in the console to explore it.

### Storybook
Feel free to add any [stories](https://storybook.js.org/docs/angular/writing-stories/introduction) as you wish to showcase different states of your component. For example, we added a story for [Card Plan - Disabled](http://localhost:9008/?path=/story/components-card--drupal-plan-disabled) because it is easier to check than to hit the **Disable switch** in **Controls** panel.

You could add stories in the same `doc.stories.ts`, or create a new file if it's relevant (E.g. `specific-variant.stories.ts`).

### Validation checklist
- [ ] Validate by designers/stackholders
- [ ] Component name and Component API are agnostic
- [ ] Component API is consistent with other components
- [ ] Accessible (use [Axe]() inside Storybook panel or [Pa11y](https://github.com/pa11y/pa11y)) 
- [ ] Content resilient
- [ ] Responsive
- [ ] Use the right CSS variables
- [ ] Reversed style
- [ ] Themable
- [ ] Unit test (relevant?)

<br/>


# Create a new component

> **Before creating a new component**, check with the Bifrost Team if its really a creation and not a variant of an existing component.

This command will help you generate the component's structure:
```bash
# Run a Bifrost CLI
npm run bifrost:generate
```

FYI, this command will:
- Copy `.templates/component-structure` folder and paste it in `/lib/components`.
- Import component's style to the main style `index.scss`.
- Expose your new Angular component in `public-api.ts`.

For Angular, don't forget to export your new module and/or component in `/lib/public-api.ts`.

<br/>


# Build and Publish Bifrost library
<br/>

Increment the version in `projects/front-end-library/package.json` with the pattern: **MAJOR.MINOR.PATCH**. 

Then build and publish:
```bash
# This command will build and publish a new version of the front-end library.
npm run publish
```

Your new package version is now available for everyone.
You could check availability on the [NPM registry](https://www.npmjs.com/package/@videotron-ui/bifrost-front-end-library) page.