import { moduleMetadata } from '@storybook/angular';
import { ArgsTable, Canvas, Meta, Story } from '@storybook/addon-docs';
import { withDesign } from 'storybook-addon-designs';
import { TwigContainerComponent } from '../../../../utils/twig-container/twig-container.component';
import { PlpComponent } from '../angular/plp.component';
import { PlpTemplateComponent } from './template.angular.component';
import { dataFilters, dataFiltersWithDisabledSelectedCheckboxes, dataFiltersNoSelection } from './data.ts';

<Meta
    title="Sections/PLP"
    component={PlpComponent}
    decorators={[
        moduleMetadata({ declarations: [PlpComponent, PlpTemplateComponent, TwigContainerComponent] }),
        withDesign,
    ]}
    parameters={{
        design: {
            type: 'figma',
            url: 'https://www.figma.com/file/wyySEz6WHDO09OirHADRUT/TMO---PLP-Filtres---PDP-Ran---Explorations?type=design&node-id=1297-36451',
            disable: false,
        },
    }}
    argTypes={{}}
/>

# PLP

## How to hide card(s) when applying a filter

This component have a JavaScript function that checks the number of results to display or not
the "no result" message. How it works is that it checks the count of card (`.bf-card`) that
has not the class `d-none` (this class applying a `display: none;` to the element).

-   If the count number is over 0, then there are results and the card(s) are displayed.
-   If the count number equal to 0, then the "no result" message is displayed.

This JavaScript function is executed on the page load. If the results are loaded via AJAX
or something like that, the function will have to be executed manually on a filter change
after the results loading is complete. The function to use is `window.checkNumberOfResults()`.
It is on the `window` scope to be usable from anywhere.

So, if you need to hide a card without removing the element from the DOM, then add the class `d-none`
to the card main element (`.bf-card`). If you have to display a hidden card, then remove the `d-none` class.

<br />

## Component API

<ArgsTable of={PlpComponent} />

## Drupal implementation example

```jsx
{% include '@bf-sections/plp/twig/index.twig' with {
    // Add relevant props here
} only %}
```

## Drupal

export const commonProps = {
    _emptyResult: false,
    dataFilters: dataFilters,
};

export const Drupal = (args) => ({
    component: TwigContainerComponent,
    props: args,
});

<Canvas withSource="none">
    <Story
        name="Drupal - No selected filter"
        height="300px"
        args={{
            elementPath: 'sections/plp/_doc/template.drupal',
            ...commonProps,
            dataFilters: dataFiltersNoSelection,
        }}
    >
        {Drupal.bind({})}
    </Story>
</Canvas>

<Canvas withSource="none">
    <Story
        name="Drupal - Loading cards"
        height="300px"
        args={{
            elementPath: 'sections/plp/_doc/template.drupal',
            ...commonProps,
            _hasLoadingCards: true,
            dataFilters: dataFiltersNoSelection,
        }}
    >
        {Drupal.bind({})}
    </Story>
</Canvas>

<Canvas withSource="none">
    <Story
        name="Drupal - With selected filters"
        height="300px"
        args={{
            elementPath: 'sections/plp/_doc/template.drupal',
            ...commonProps,
        }}
    >
        {Drupal.bind({})}
    </Story>
</Canvas>

<Canvas withSource="none">
    <Story
        name="Drupal - With disabled selected filters"
        height="300px"
        args={{
            elementPath: 'sections/plp/_doc/template.drupal',
            ...commonProps,
            dataFilters: dataFiltersWithDisabledSelectedCheckboxes,
        }}
    >
        {Drupal.bind({})}
    </Story>
</Canvas>

<Canvas withSource="none">
    <Story
        name="Drupal - No result"
        height="300px"
        args={{
            elementPath: 'sections/plp/_doc/template.drupal',
            ...commonProps,
            _emptyResult: true,
        }}
    >
        {Drupal.bind({})}
    </Story>
</Canvas>

<!--
For now, Angular components ar not used, so it is hidden by default.

## Angular

export const Angular = (args) => ({
  component: PlpTemplateComponent,
  props: args,
});

<Canvas withSource='none'>
    <Story
        name='Angular'
        args={{
            label: 'Plp'
        }}
    >
        {Angular.bind({})}
    </Story>
</Canvas>

## Angular implementation example

Please, read the [Implementation Page](/?path=/docs/implementation-angular--page).
-->

## Design Guidelines

<iframe
    width="100%"
    height="450"
    src="https://www.figma.com/embed?embed_host=share&url=https%3A%2F%2Fwww.figma.com%2Ffile%2FwyySEz6WHDO09OirHADRUT%2FTMO---PLP-Filtres---PDP-Ran---Explorations%3Ftype%3Ddesign%26node-id%3D1297-36451&chrome=DOCUMENTATION"
    frameBorder="0"
    allowFullScreen
></iframe>
