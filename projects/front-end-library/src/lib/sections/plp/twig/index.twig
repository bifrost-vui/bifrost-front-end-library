{# Import macros #}
{% import "@bf-utils/macros/twig/index.twig" as macros %}

{# Boolean Variables #}
{% set hasId = id is defined and id is not empty %}

{# Default Variables #}
{% set class = class|default("") %}

{# Arrays of Classes With Dynamic Elements #}
{% set plpClasses = [
  "bf-plp",
  (class),
] %}

{# Chips - Selected Filters #}
{% set selectedCheckboxes = [] %}
{% for filterObj in dataFilters %}
  {% if filterObj.dataCheckboxes is defined %}
    {% for option in filterObj.dataCheckboxes.options %}
      {% if option.isChecked is same as(true) %}
        {% set selectedCheckboxes = selectedCheckboxes|merge([{
          class: "js-bf-plp-filters-chip",
          deleteButton: "removeFilter('" ~ option.id ~ "')"|raw,
          deleteButtonAriaLabel: "On a click, it will remove this filter."|t,
          id: option.id ~ "_chip",
          isDisabled: false,
          label: option.label,
        }]) %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}

{# Template #}
<div {{ macros.addAttributes({
  "class": plpClasses|join(' ')|trim,
  "id": (hasId ? id),
}) }}>

  {# Number of products results #}
  <p class="bf-plp__nb-results">
    {{ numberOfResults|number_format ~ " " ~ "results"|t }}
  </p>

  <div class="bf-plp__filters-container">
    <div class="bf-plp__filters-container__chips">
      {# Chip template - Always hidden #}
      {% include "@bf-components/chip/twig/index.twig" with {
        class: "js-bf-filters-chip-template d-none",
        deleteButton: "removeFilter()",
        deleteButtonAriaLabel: "On a click, it will remove this filter."|t,
        id: "chipTempId",
        isDisabled: true,
        label: "chipTempLabel",
      } only %}

      {# Filter Chips #}
      {% include '@bf-components/chips-group/twig/index.twig' with {
          class: "bf-plp__filters-container__chips__group js-bf-plp-filters-container-chips-group",
          chipsData: selectedCheckboxes,
          id: "selectedFiltersChips",
      } only %}
    </div>

    {# Filters #}
    <div class="bf-plp__filters-container__filters">
      {% for dataFilter in dataFilters %}

        {% set filterVars = {
          class: dataFilter.class,
          id: dataFilter.id,
          idParent: id,
          isDisabled: dataFilter.isDisabled|default(false),
          isExpandedByDefault: dataFilter.isExpandedByDefault|default(true),
          numberOfCheckboxesToDisplay: dataFilter.numberOfCheckboxesToDisplay,
          title: dataFilter.title,
        } %}

        {% if dataFilter.dataCheckboxes is defined and dataFilter.dataCheckboxes is not empty %}
          {% set filterVars = filterVars|merge({dataCheckboxes: dataFilter.dataCheckboxes}) %}
        {% elseif dataFilter.dataSlider is defined and dataFilter.dataSlider is not empty %}
          {% set filterVars = filterVars|merge({dataSlider: dataFilter.dataSlider}) %}
        {% endif %}

        {% include "@bf-components/filter/twig/index.twig" with filterVars only %}
      {% endfor %}
    </div>

    {% block customFiltersBlock %}{% endblock %}
  </div>

  <div class="bf-plp__results">
    {% block resultsBlock %}{% endblock %}
  </div>

</div>
